<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.3.1"><meta name=author content="Max Woolf"><meta name=description content="I have reverse-engineered data and code with R and ggplot2 in order to create detailed implementations of bootstrapping, and also to add a few visual improvements."><link rel=alternate hreflang=en-us href=https://minimaxir.com/2015/09/bootstrap-resample/><meta name=theme-color content=#2962ff><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.0/css/all.css integrity=sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700|Source+Code+Pro:400,400italic,700&display=swap"><link rel=stylesheet href=/css/academic.min.d60353c45a1511432f9bc3071cf07140.css><link rel=stylesheet href=/css/academic.b011cb496b1db375ea969a485c505836.css><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=https://minimaxir.com/2015/09/bootstrap-resample/><meta property=twitter:card content=summary_large_image><meta property=twitter:site content=@minimaxir><meta property=twitter:creator content=@minimaxir><meta property=article:author content=https://www.facebook.com/max.woolf><meta property=og:site_name content="Max Woolf's Blog"><meta property=og:url content=https://minimaxir.com/2015/09/bootstrap-resample/><meta property=og:type content=article><meta property=og:title content="Coding, Visualizing, and Animating Bootstrap Resampling"><meta property=og:description content="I have reverse-engineered data and code with R and ggplot2 in order to create detailed implementations of bootstrapping, and also to add a few visual improvements."><meta property=og:image content=https://minimaxir.com/2015/09/bootstrap-resample/featured.png><meta property=twitter:image content=https://minimaxir.com/2015/09/bootstrap-resample/featured.png><meta property=og:locale content=en-us><meta property=article:published_time content=2015-09-22T08:00:00-07:00><meta property=article:modified_time content=2015-09-22T08:00:00-07:00><title>Coding, Visualizing, and Animating Bootstrap Resampling | Max Woolf&#39;s Blog</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id=navbar-main><div class=container><a class=navbar-brand href=/>Max Woolf&#39;s Blog</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=/post/><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/portfolio/><span>Portfolio</span></a></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://www.patreon.com/minimaxir target=_blank rel=noopener><span><i class="fab fa-patreon"></i>Patreon</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/minimaxir target=_blank rel=noopener><span><i class="fab fa-github-alt"></i>GitHub</span></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><article class=article itemscope itemtype=http://schema.org/Article><div class="article-container pt-3"><h1 itemprop=name>Coding, Visualizing, and Animating Bootstrap Resampling</h1><meta content="2015-09-22 08:00:00 -0700 PDT" itemprop=datePublished><meta content="2015-09-22 08:00:00 -0700 PDT" itemprop=dateModified><div class=article-metadata><span class=article-date><time>September 22, 2015</time></span>
<span class=middot-divider></span><span class=article-reading-time>6 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder"></i><a href=/categories/data-science/>Data Science</a></span><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https://minimaxir.com/2015/09/bootstrap-resample/&amp;text=Coding,%20Visualizing,%20and%20Animating%20Bootstrap%20Resampling" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https://minimaxir.com/2015/09/bootstrap-resample/&amp;t=Coding,%20Visualizing,%20and%20Animating%20Bootstrap%20Resampling" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook-f"></i></a></li><li><a href="mailto:?subject=Coding,%20Visualizing,%20and%20Animating%20Bootstrap%20Resampling&amp;body=https://minimaxir.com/2015/09/bootstrap-resample/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https://minimaxir.com/2015/09/bootstrap-resample/&amp;title=Coding,%20Visualizing,%20and%20Animating%20Bootstrap%20Resampling" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="https://reddit.com/submit?url=https://minimaxir.com/2015/09/bootstrap-resample/&amp;title=Coding,%20Visualizing,%20and%20Animating%20Bootstrap%20Resampling" target=_blank rel=noopener class=share-btn-reddit><i class="fab fa-reddit-alien"></i></a></li></ul></div></div></div><div class=article-container><div class=article-style itemprop=articleBody><p>A few days ago on Hacker News, I saw a <a href="https://news.ycombinator.com/item?id=10244950" target=_blank>nice submission</a> titled &ldquo;<a href=https://speakerdeck.com/jakevdp/statistics-for-hackers target=_blank>Statistics for Hackers</a>,&rdquo; which was a slide deck written and presented by <a href=https://twitter.com/jakevdp target=_blank>Jake Vanderplas</a>. The talk is very explicitly a tutorial for a few good statistical methods for those without a statistical background, using simple tools &ldquo;hackers&rdquo; are familiar with and are occasionally very necessary (it&rsquo;s not hacking in the sense of &ldquo;growth hacking,&rdquo; thankfully).</p><p>One important statistical tool discussed in the presentation is <a href=https://en.wikipedia.org/wiki/Bootstrapping_%28statistics%29 target=_blank>bootstrap resampling</a>, a good example for a programming-oriented presentation as it can be easily done with code. Bootstrapping is when a data set is randomized many, many times (usually thousands of times) to simulate similar data sets, and use those simulated datasets to obtain a more accurate range for a particular statistic about the data set, such as the statistical average.</p><p><img src=/img/bootstrap-resample/talk0.png alt></p><p>I have reverse-engineered the data and code from the talk with R and ggplot2 in order to create more detailed implementations of bootstrapping, and also to add a few visual improvements.</p><h2 id=preparing-the-data>Preparing the Data</h2><p><em>If you want to view the code with more detailed output and extensive code for the ggplot2 charts, read this <a href=https://github.com/minimaxir/bootstrap-resample-notebook/blob/master/bootstrap_resample_notebook.ipynb target=_blank>Jupyter notebook</a>, hosted and open-sourced on GitHub.</em></p><p>The first thing to do is recreate the test data.</p><p><img src=/img/bootstrap-resample/talk1.png alt></p><p>Data is manually transcribed from the linked talk (to the best of my ability), and converted to a <code>tbl_df</code> for ease of use.</p><pre><code class=language-R>x &lt;- c(8.1, 8.4, 8.8, 8.7, 9, 9.1, 9.2, 9.3, 9.4, 9.6, 9.9, 10, 10, 10.5, 10.6, 10.6, 11.2, 11.8, 12.6)
y &lt;- c(21, 19, 18, 16, 15, 17, 17, 17, 19, 14, 14, 15, 11, 12, 12, 13, 10, 8, 9)

df &lt;- tbl_df(data.frame(x,y))
</code></pre><p>Let&rsquo;s create a quick plot in ggplot2 to compare it to the source image:</p><pre><code class=language-R>qplot(x, y, df) + geom_smooth(method=&quot;lm&quot;)
</code></pre><p><img src=/img/bootstrap-resample/qplot.png alt></p><p>Pretty good copy, and it comes with a linear regression line for one line of code!</p><p>Performing the linear regression within R itself (via <code>lm()</code>) results in a model containing an X-intercept of 42.3 and a slope of -2.81. (<em>y = 42.3 - 2.81x</em>)</p><ul><li><strong>42.3</strong>, the coefficient for the (Intercept), represents the value of the stack if Wind Speed is 0.</li><li>For every 1 unit increase in Wind Speed, the estimated Height <strong>decreases by 2.81</strong>, the coefficient for the <code>x</code> variable.</li></ul><p>Both coefficients are extremely statistically significant. Regression as a whole has a R<sup>2</sup> of 82.71%; indicating that the change in Wind Speed explains 82.71% of the variation in Height. That&rsquo;s enough to assert causality in this mock data.</p><p>Now we can know the true value of the coefficients for the data, we can perform bootstrapping. We can create a function to perform a linear regression on the data frame, having been resampled <em>with replacement</em> (important!), and return the model coefficients:</p><pre><code class=language-R>lm_res &lt;- function(df) {
    model &lt;- lm(y ~ x, df %&gt;% sample_frac(replace=T))
    return (model$coefficients)
}
</code></pre><p>R&rsquo;s <code>replicate</code> function runs a function a specified amount of times and stores the results in the same data frame; perfect for bootstrapping.</p><p>There&rsquo;s no limit to the number of repetitions you can perform using this method; however, you can hit diminishing returns as the distribution converges. Generally, 2,000 trials minimum are recommended, but let&rsquo;s do 10,000 trials just to be sure.</p><pre><code class=language-R>df_boot &lt;- replicate(10000, lm_res(df))
df_boot &lt;- tbl_df(data.frame(t(df_boot)))
</code></pre><p>This completed in about 13 seconds on my computer, and results in a dataset of 10,000 pairs of X-intercept and wind speed coefficients!</p><p>Now we can build 95% confidence intervals for each coefficient. This is done by finding the 2.5% quartile, and the 97.5% quartile; since there are a very large amount of bootstrapped samples, the confidence interval will be very accurate.</p><p>This can be done easily using the <code>gather()</code> function from <code>tidyr</code> to convert the data from wide to long, and <code>dplyr</code>&rsquo;s aggregation and summarization functions.</p><pre><code class=language-R>df_boot_agg &lt;- df_boot %&gt;%
                gather(var, value) %&gt;%
                group_by(var) %&gt;%
                summarize(
                    average = mean(value),
                    low_ci = quantile(value, 0.025),
                    high_ci = quantile(value, 0.975)
                        )
</code></pre><p>From the output, the true value of the X intercept has a 95% chance of being between 36.9 and 49.3, and the true value of the Wind Speed coefficient has a 95% chance of being between -3.53 and -2.28.</p><h2 id=plotting-the-bootstrap-of-one-variable>Plotting the Bootstrap of One Variable</h2><p>The Wind Speed coefficient is much more interesting, statistically. We have enough information to derive a ggplot2 histogram of the resampled data, and a graphical representation of the confidence interval. We can also include the true value of the coefficient in the visualization (as the dotted vertical line) to see if it make sense.</p><p><img src=/img/bootstrap-resample/uni_one.png alt></p><p>Plot is close to a <a href=https://en.wikipedia.org/wiki/Normal_distribution target=_blank>Normal distribution</a> / bell curve, which is a nice property of bootstrapping and makes the results easier to analyze. The true coefficient value is in the interval, but not quite at the center.</p><p>We can write a function to generate a plot for different data size subsets (e.g. 100 samples, 200 samples, etc. up to 10,000 samples). This shows the impact of bootstrapping and how the confidence estimate intervals converge as the number of trials increases. Each of these plots serve as a frame in a GIF.</p><p>Each of these frames are stitched together into a high- quality, low file size by my new <a href=https://github.com/minimaxir/frames-to-gif-osx target=_blank>Convert Frames to GIF OS X tool</a>!</p><p><img src=/img/bootstrap-resample/uni_frames.gif alt></p><p>A 99 frame, 640px width GIF, at only half a megabyte! (R has an <a href=https://cran.r-project.org/web/packages/animation/index.html target=_blank>animation package</a>, but with much worse results, which was the motivation for writing the OS X tool)</p><p>From the GIF, it&rsquo;s clear to see that the confidence intervals converge to the final values at about 2000 trials, with the shape of the distribution stabilizing at about 7000 trials.</p><h2 id=plotting-the-bootstrap-of-two-variables>Plotting the Bootstrap of Two Variables</h2><p>The X-intercept and the Wind Speed coefficient have a linked, negatively correlated relationship, so it makes sense to plot them simultaneously, as in the original talk.</p><p><img src=/img/bootstrap-resample/talk2.png alt></p><p>ggplot2&rsquo;s <code>density2d</code> plots a <a href=https://en.wikipedia.org/wiki/Contour_line target=_blank>contour map</a>, which will help illustrate the area and magnitude where the data converges on a 2D plane. We can also include an <strong>orange</strong> bounding box using the specified values for the 2D confidence intervals for each variable, and a <strong>red</strong> dot representing the true value of the coefficients.</p><p><img src=/img/bootstrap-resample/bi_one.png alt></p><p>The pair of coefficients can only occur in a certain range of values, much smaller than the bounding box. The true value is close to the most frequent occurrence, too.</p><p>Then we can make another GIF using the same method:</p><p><img src=/img/bootstrap-resample/bi_frames.gif alt></p><p>Again, the visualization converges relatively quickly at about 2,000 trials. (although, in retrospect, the orange bounding box may not have been necessary.)</p><p>While the sample dataset isn&rsquo;t the most ideal for bootstrapping due to its extremely small size, bootstrapping at the least adds some clarity to the issues that results when simply performing statistics on a given dataset.</p><p><em>Again, if you want to view the code with more detailed output and extensive code for the ggplot2 charts, read this <a href=https://github.com/minimaxir/bootstrap-resample-notebook/blob/master/bootstrap_resample_notebook.ipynb target=_blank>Jupyter notebook</a>.</em></p><div class="alert alert-note"><div>If you liked this blog post, I have set up a <a href=https://www.patreon.com/minimaxir target=_blank>Patreon</a> to fund my machine learning/deep learning/software/hardware needs for my future crazy yet cool projects, and any monetary contributions to the Patreon are appreciated and will be put to good creative use.</div></div></div><div class=article-tags><a class="badge badge-light" href=/tags/r/>R</a>
<a class="badge badge-light" href=/tags/ggplot2/>ggplot2</a>
<a class="badge badge-light" href=/tags/animation/>Animation</a></div><div class="media author-card" itemscope itemtype=http://schema.org/Person><img class="portrait mr-3" src="https://s.gravatar.com/avatar/28f09e3deff62333b3f32f19d3971d46?s=200')" itemprop=image alt=Avatar><div class=media-body><h5 class=card-title itemprop=name><a href=https://minimaxir.com/>Max Woolf</a></h5><h6 class=card-subtitle>Data Scientist at BuzzFeed</h6><p class=card-text itemprop=description>Ex-Apple. Carnegie Mellon graduate. Plotter of pretty charts. Former TechCrunch comment troll.</p><ul class=network-icon aria-hidden=true><li><a itemprop=sameAs href=https://twitter.com/minimaxir target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a itemprop=sameAs href=https://linkedin.com/in/minimaxir target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a itemprop=sameAs href=https:/youtube.com/minimaxir target=_blank rel=noopener><i class="fab fa-youtube"></i></a></li><li><a itemprop=sameAs href=https:/twitch.tv/minimaxir target=_blank rel=noopener><i class="fab fa-twitch"></i></a></li><li><a itemprop=sameAs href=mailto:max@minimaxir.com><i class="fas fa-envelope"></i></a></li></ul></div></div><div class=article-widget><div class=hr-light></div><h3>Related</h3><ul><li><a href=/2015/08/nyc-map/>Plotting a Map of New York City Using Only Taxi Location Data</a></li><li><a href=/2015/06/cars-2/>Why is the Most-Viewed Gaming Video on YouTube About Cars 2?</a></li><li><a href=/2015/02/password-numbers/>Analyzing the Patterns of Numbers in 10 Million Passwords</a></li><li><a href=/2015/02/ggplot-tutorial/>An Introduction on How to Make Beautiful Charts With R and ggplot2</a></li><li><a href=/2015/01/linkbait/>Quantifying the Clickbait and Linkbait in BuzzFeed Article Titles</a></li></ul></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Next</div><a href=/2015/10/reddit-bigquery/ rel=next>How to Analyze Every Reddit Submission and Comment, in Seconds, for Free</a></div><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/2015/08/gif-to-video-osx/ rel=prev>Making a Video-to-GIF Right-Click Menu Item in OS X</a></div></div></div><section id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"minimaxir"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin=anonymous></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/academic.min.bc1d5e4f014b8d38d75521ad1ae2ab18.js></script><div class=container><footer class=site-footer><p class=powered-by>Copyright Max Woolf &copy; 2019 &middot;
Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# id=back_to_top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&times;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>
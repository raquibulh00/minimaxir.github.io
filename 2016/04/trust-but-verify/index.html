<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.3.1"><meta name=author content="Max Woolf"><meta name=description content="The 1972 TV Special 'The Lorax' is the best movie ever, earning $1.2 billion?"><link rel=alternate hreflang=en-us href=https://minimaxir.com/2016/04/trust-but-verify/><meta name=theme-color content=#2962ff><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.0/css/all.css integrity=sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700|Source+Code+Pro:400,400italic,700&display=swap"><link rel=stylesheet href=/css/academic.min.a5099be3e049a7eefdcd4143a4af338a.css><link rel=stylesheet href=/css/academic.80785e08a563f430e47a4d753c8d9f2d.css><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=https://minimaxir.com/2016/04/trust-but-verify/><meta property=twitter:card content=summary_large_image><meta property=twitter:site content=@minimaxir><meta property=twitter:creator content=@minimaxir><meta property=article:author content=https://www.facebook.com/max.woolf><meta property=og:site_name content="Max Woolf's Blog"><meta property=og:url content=https://minimaxir.com/2016/04/trust-but-verify/><meta property=og:type content=article><meta property=og:title content="The Importance of Sanity-Checking Datasets Before Analysis"><meta property=og:description content="The 1972 TV Special 'The Lorax' is the best movie ever, earning $1.2 billion?"><meta property=og:image content=https://minimaxir.com/2016/04/trust-but-verify/featured.png><meta property=twitter:image content=https://minimaxir.com/2016/04/trust-but-verify/featured.png><meta property=og:locale content=en-us><meta property=article:published_time content=2016-04-06T08:00:00-07:00><meta property=article:modified_time content=2016-04-06T08:00:00-07:00><title>The Importance of Sanity-Checking Datasets Before Analysis | Max Woolf&#39;s Blog</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id=navbar-main><div class=container><a class=navbar-brand href=/>Max Woolf&#39;s Blog</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=/post/><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/portfolio/><span>Portfolio</span></a></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://www.patreon.com/minimaxir target=_blank rel=noopener><span><i class="fab fa-patreon mr-1"></i>Patreon</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/minimaxir target=_blank rel=noopener><span><i class="fab fa-github-alt mr-1"></i>GitHub</span></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><article class=article itemscope itemtype=http://schema.org/Article><div class="article-container pt-3"><h1 itemprop=name>The Importance of Sanity-Checking Datasets Before Analysis</h1><meta content="2016-04-06 08:00:00 -0700 PDT" itemprop=datePublished><meta content="2016-04-06 08:00:00 -0700 PDT" itemprop=dateModified><div class=article-metadata><span class=article-date><time>April 6, 2016</time></span>
<span class=middot-divider></span><span class=article-reading-time>6 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/categories/thought-piece/>Thought Piece</a></span><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https://minimaxir.com/2016/04/trust-but-verify/&amp;text=The%20Importance%20of%20Sanity-Checking%20Datasets%20Before%20Analysis" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https://minimaxir.com/2016/04/trust-but-verify/&amp;t=The%20Importance%20of%20Sanity-Checking%20Datasets%20Before%20Analysis" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook-f"></i></a></li><li><a href="mailto:?subject=The%20Importance%20of%20Sanity-Checking%20Datasets%20Before%20Analysis&amp;body=https://minimaxir.com/2016/04/trust-but-verify/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https://minimaxir.com/2016/04/trust-but-verify/&amp;title=The%20Importance%20of%20Sanity-Checking%20Datasets%20Before%20Analysis" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="https://reddit.com/submit?url=https://minimaxir.com/2016/04/trust-but-verify/&amp;title=The%20Importance%20of%20Sanity-Checking%20Datasets%20Before%20Analysis" target=_blank rel=noopener class=share-btn-reddit><i class="fab fa-reddit-alien"></i></a></li></ul></div></div></div><div class=article-container><div class=article-style itemprop=articleBody><p>I&rsquo;ve done some cool things with movie data using a dataset from <a href=http://www.omdbapi.com target=_blank>OMDb API</a>, which is sourced from <a href=http://www.imdb.com target=_blank>IMDb</a> and <a href=http://www.rottentomatoes.com target=_blank>Rotten Tomatoes</a> data. In my <a href=http://minimaxir.com/2016/01/movie-revenue-ratings/ target=_blank>previous article</a> on the dataset, I plotted the relationship between the domestic box office revenue of movies and their Rotten Tomatoes scores.</p><p><img src=/img/movie-revenue-ratings/box-office-rating-1.png alt></p><p>I want to take another look at domestic Box Office Revenues with aggregate statistics such as means/medians on categorical variables such as MPAA rating and release month. For this type of analysis in particular, I&rsquo;ll also need to implement code in <a href=https://www.r-project.org target=_blank>R</a> for inflation adjustment.</p><p>However, I ran into a few unexpectedly silly issues.</p><h2 id=seeing-double>Seeing Double</h2><p>There are many similarities between data validation and the Quality Assurance process of product development, which is why this particular area appeals to me personally as a Software QA Engineer. Whenever a cool dataset is released publicly, I play around with it to look for any obvious flaws and to get a good all-around benchmark on the robustness of the data (this is a separate procedure from the traditional &ldquo;data cleaning&rdquo; phase necessary to begin quantification on some poorly-structured datasets).</p><p>Do the extreme values in the data make sense? Is the data encoded in a sane format? Are there any obvious gaps or logical contradictions in summary representations of the data, especially when compared to other canonical sources?</p><p>These concerns are also some of the reasons I&rsquo;ve switched to the <a href=http://jupyter.org target=_blank>Jupyter Notebook</a> as my primary data science IDE. After each block of code which transforms data, I can print the data frame inline to immediately see the results of the code execution, and refer back to them if anything odd happens in the future.</p><p>Let&rsquo;s say I have a data frame of Movies using the latest data dump (3/26/16) from OMDb. This data set contains 1,160,273 movies, including both IMDb and Rotten Tomatoes data. After cleaning the data (not shown), I can use the R package <code>dplyr</code> by Hadley Wickham to sort the data frame by Box Office Revenue descending, and print the <code>head</code> (top) of the data.</p><pre><code class=language-R>print(df %&gt;% select(imdbID, Title, Year, BoxOffice) %&gt;% arrange(desc(BoxOffice)) %&gt;% head(25), n = 25)
</code></pre><p><img src=/img/trust-but-verify/data-2.png alt></p><p>Those movies being the best <em>makes sense</em>. For <a href=http://www.rottentomatoes.com/m/star_wars_episode_vii_the_force_awakens/ target=_blank>Star Wars: The Force Awakens</a>, I can compare it to the Box Office reported on the corresponding Rotten Tomatoes page, which in turn matches the <a href="http://www.boxofficemojo.com/movies/?id=starwars7.htm" target=_blank>domestic Box Office Revenue</a> on <a href=http://www.boxofficemojo.com target=_blank>Box Office Mojo</a>.</p><p>But wait, <a href=https://en.wikipedia.org/wiki/The_Dark_Knight_%28film%29 target=_blank>The Dark Knight</a> appears <em>twice</em>? How?!</p><p>There&rsquo;s no way I would have missed something this obvious during the sanity-check for my previous article. In order to make sure that I&rsquo;m not going insane, I double-checked the December 2015 data dump I used for that post, derived the top movies with the same methodology for the modern data dump, and the duplicate movies <em>were not present</em>. Weird.</p><p>There are 2 different IDs for
The Dark Knight, and for some other movies near the top (<a href=http://www.imdb.com/title/tt4817264/ target=_blank>Inside Out</a>, &ldquo;<a href=http://www.imdb.com/title/tt3138972/ target=_blank>The Gravity</a>&rdquo;). Fortunately, duplicate data like this is easy to debug. The second data entry for The Dark Knight has a greater IMDb ID (1774602) which means it was likely added to the site later. Let&rsquo;s look up the <a href=http://www.imdb.com/title/tt1774602/ target=_blank>corresponding IMDb page</a>:</p><p><img src=/img/trust-but-verify/dark-knight.png alt></p><p>Huh. Apparently someone put a filler movie entry with the same name and release year as a blockbuster movie in hopes that people search for it by accident (and since it received 50 ratings and an average score of 8.6, this tactic was successful).</p><p>Using the Rotten Tomatoes <a href=http://developer.rottentomatoes.com/docs/read/json/v10/Movie_Alias target=_blank>IMDb Lookup API</a>, we find that &ldquo;The Dark Knight&rdquo; page on Rotten Tomatoes&hellip;<a href="http://api.rottentomatoes.com/api/public/v1.0/movie_alias.json?type=imdb&amp;id=1774602" target=_blank>doesn&rsquo;t exist</a>.</p><p>We can run a safe deduplicate by removing entries with the same title (excluding the &ldquo;The&rdquo; if present) and release year.</p><pre><code class=language-R>df_dup &lt;- df %&gt;% select(Title, Year) %&gt;% mutate(Title = gsub(&quot;The &quot;, &quot;&quot;, Title))
dup &lt;- duplicated(df_dup)   # find entry indices which are duplicates
rm(df_dup)   # remove temp dataframe

df_dedup &lt;- df %&gt;% filter(!dup)   # keep entries which are *not* dups
print(df_dedup %&gt;% select(imdbID, Title, Year, BoxOffice) %&gt;% arrange(desc(BoxOffice)) %&gt;% head(25), n = 25)
</code></pre><p><img src=/img/trust-but-verify/data-1.png alt></p><p>There we go! The de-duped dataset has 1,114,431 movies, impliying that there were 45,842 of these duplicate entries.</p><p>I&rsquo;m not sure <em>whose</em> fault it is that duplicate movies suddenly became present in the data dump: OMDb or Rotten Tomatoes. <em>But it doesn&rsquo;t matter</em>: the wrong entries still need to be addressed, and it&rsquo;s good to have a test case for the future too.</p><h2 id=inflation-station>Inflation Station</h2><p>A <a href=http://stackoverflow.com/a/26068058 target=_blank>Stack Overflow answer</a> from <a href=http://stackoverflow.com/users/1048757/brash-equilibrium target=_blank>Ben Hanowell</a> has a good R implementation and rationale for implementing inflation adjustment using the <a href=https://research.stlouisfed.org/fred2/data/CPIAUCSL.txt target=_blank>historical Consumer Price Index data</a> from the <a href=https://www.stlouisfed.org target=_blank>Federal Reserve Bank of St. Louis</a>.</p><p>Take the index for each year (averaging each month for simplicity) and create an adjustment factor to convert historical dollar amounts into present-day dollar amounts. Much better than plugging hundreds of thousands of values into an online calculator. Here&rsquo;s the SO code made <code>dplyr</code>-friendly for this purpose, with the requisite sanity-checks.</p><pre><code class=language-R>inflation &lt;- read_csv(&quot;http://research.stlouisfed.org/fred2/data/CPIAUCSL.csv&quot;) %&gt;%
                    group_by(Year = as.integer(substr(DATE, 1, 4))) %&gt;%
                    summarize(Avg_Value = mean(VALUE)) %&gt;%   # average across all months
                    mutate(Adjust = tail(Avg_Value, 1) / Avg_Value)   # normalize by most-recent year

print(inflation %&gt;% head())
print(inflation %&gt;% tail())
</code></pre><p><img src=/img/trust-but-verify/inf.png alt></p><p>For example, to get the inflation-adjusted Box Office Revenue for a movie released in 1949 in 2016 dollars, we multiply the reported revenue by 10. That sounds about right (and matches closely enough to the output of the <a href="http://data.bls.gov/cgi-bin/cpicalc.pl?cost1=1&amp;year1=1949&amp;year2=2016" target=_blank>Bureau of Labor Statistics inflation calculator</a>).</p><p>Now map each inflation adjustment factor to each movie by merging the two datasets (on the <code>Year</code> column), then multiply the Box Office revenue by the adjustment factor to get the inflation-adjusted revenue. Plus another sanity-check for good measure.</p><pre><code class=language-r>df_dedup_join &lt;- df_dedup %&gt;% inner_join(inflation) %&gt;% mutate(AdjBoxOffice = BoxOffice * Adjust)

print(df_dedup_join %&gt;% select(Title, Year, AdjBoxOffice) %&gt;% arrange(desc(AdjBoxOffice)) %&gt;% head(25), n=25)
</code></pre><p><img src=/img/trust-but-verify/data-3.png alt></p><p>Uh-oh.</p><p>I mean, <a href=https://en.wikipedia.org/wiki/The_Lorax_(TV_special) target=_blank>The Lorax</a> probably earned $1.2 billion in VHS sales for Earth Day education <em>alone</em>, but the TV special was never released in theaters. There was a <a href=https://en.wikipedia.org/wiki/The_Lorax_(film) target=_blank>CGI remake of The Lorax</a> a few years ago which was reasonably popular. Could it be that someone at Rotten Tomatoes or Box Office Mojo confused the two media?</p><p>That is exactly what happened. On Rotten Tomatoes, The <a href=http://www.rottentomatoes.com/m/the-lorax/ target=_blank>1972 Lorax</a> was encoded with similar box office revenue as the <a href=http://www.rottentomatoes.com/m/the_lorax/ target=_blank>2012 Lorax</a>; then the inflation factor sextupled it. For this type of data fidelity issue, it&rsquo;s considerably more obvious whose at fault.</p><p>Unfortunately, that&rsquo;s not the end of problems with the dataset. I compared my results with <a href=http://www.vox.com/2016/4/4/11351788/batman-v-superman-terrible-reviews#undefined target=_blank>Vox&rsquo;s dataset</a> on worldwide historical box office revenues. In the Top 200 Movies by inflation-adjusted revenue, there are noted historical movie omissions such as <a href=http://www.rottentomatoes.com/m/jaws/ target=_blank>Jaws</a> and <a href=http://www.rottentomatoes.com/m/star_wars/ target=_blank>Star Wars: A New Hope</a>. It turns out Rotten Tomatoes does not have Box Office Revenue data for these movies at all.</p><p>That is a very serious problem which I&rsquo;ll have to think about if it blocks any analysis on aggregate box office data completely. In the end, sanity-checking third party data is important because you never know <em>how</em> the data will surprise you, until it&rsquo;s too late.</p><hr><p><em>You can view the Top 200 movies by domestic box office revenue for each of the 12/15 source dataset, the 3/16 dataset, the 3/16 deduped dataset, and the 3/16 deduced inflation-adjusted data <a href=https://github.com/minimaxir/movie-data-sanity-checking target=_blank>in this GitHub repository</a>, along with the Jupyter notebook.</em></p><div class="alert alert-note"><div>If you liked this blog post, I have set up a <a href=https://www.patreon.com/minimaxir target=_blank>Patreon</a> to fund my machine learning/deep learning/software/hardware needs for my future crazy yet cool projects, and any monetary contributions to the Patreon are appreciated and will be put to good creative use.</div></div></div><div class="media author-card" itemscope itemtype=http://schema.org/Person><img class="portrait mr-3" src="https://s.gravatar.com/avatar/28f09e3deff62333b3f32f19d3971d46?s=200')" itemprop=image alt=Avatar><div class=media-body><h5 class=card-title itemprop=name><a href=https://minimaxir.com/>Max Woolf</a></h5><h6 class=card-subtitle>Data Scientist at BuzzFeed</h6><p class=card-text itemprop=description>Ex-Apple. Carnegie Mellon graduate. Plotter of pretty charts. Former TechCrunch comment troll.</p><ul class=network-icon aria-hidden=true><li><a itemprop=sameAs href=https://twitter.com/minimaxir target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a itemprop=sameAs href=https://linkedin.com/in/minimaxir target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a itemprop=sameAs href=https://youtube.com/minimaxir target=_blank rel=noopener><i class="fab fa-youtube"></i></a></li><li><a itemprop=sameAs href=https://twitch.tv/minimaxir target=_blank rel=noopener><i class="fab fa-twitch"></i></a></li><li><a itemprop=sameAs href=mailto:max@minimaxir.com><i class="fas fa-envelope"></i></a></li></ul></div></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Next</div><a href=/2016/04/movie-gender/ rel=next>Blockbuster Movies with Male Leads Earn More Than Those with Female Leads</a></div><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/2016/03/gif-unlimited/ rel=prev>Unlimited Data Storage Using Image Steganography and Cat GIFs</a></div></div></div><section id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"minimaxir"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin=anonymous></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/academic.min.bc1d5e4f014b8d38d75521ad1ae2ab18.js></script><div class=container><footer class=site-footer><p class=powered-by>Copyright Max Woolf &copy; 2019 &middot;
Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# id=back_to_top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&times;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>